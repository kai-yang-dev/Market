<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fraud Detector Tester</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; max-width: 900px; }
    h1 { margin-bottom: 8px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 16px; margin: 16px 0; }
    label { display:block; margin: 8px 0 4px; }
    textarea, input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
    input[type="file"] { width: 100%; }
    button { padding: 10px 14px; border: 0; border-radius: 8px; cursor: pointer; }
    button:hover { opacity: 0.95; }
    .row { display:flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .row button { background:#111; color:#fff; }
    .small { font-size: 12px; color: #555; }
    pre { background: #0b1020; color: #e6edf3; padding: 12px; border-radius: 10px; overflow:auto; }
    .ok { color: #0a7; font-weight: 700; }
    .bad { color: #c22; font-weight: 700; }
    .hint { background:#f8f8f8; padding:10px; border-radius:8px; border:1px dashed #ccc; }
  </style>
</head>
<body>
  <h1>Fraud Detector Tester</h1>
  <div class="small">
    Make sure your FastAPI server is running on <b>http://localhost:5001</b>
  </div>

  <div class="card">
    <h2>1) Text Test (/check/text)</h2>
    <div class="hint small">
      Try examples:<br/>
      • Hello how are you<br/>
      • Contact me on telegram @john_doe<br/>
      • Send 50 USDT to my wallet
    </div>

    <label for="textMessage">Message</label>
    <textarea id="textMessage" rows="4">Hello, how are you today?</textarea>

    <div class="row" style="margin-top:10px;">
      <button id="btnText">Check Text</button>
      <button id="btnTextSafe" type="button">Fill Safe</button>
      <button id="btnTextTelegram" type="button">Fill Telegram</button>
      <button id="btnTextCrypto" type="button">Fill Crypto</button>
    </div>

    <div style="margin-top:12px;">
      <div id="textStatus" class="small"></div>
      <pre id="textOut">{}</pre>
    </div>
  </div>

  <div class="card">
    <h2>2) Image Test (/check/image)</h2>
    <div class="hint small">
      Upload an image with text (Telegram/WhatsApp/phone number) to trigger fraud.
    </div>

    <label for="imageFile">Choose image</label>
    <input id="imageFile" type="file" accept="image/*" />

    <div class="row" style="margin-top:10px;">
      <button id="btnImage">Check Image</button>
    </div>

    <div style="margin-top:12px;">
      <div id="imageStatus" class="small"></div>
      <pre id="imageOut">{}</pre>
    </div>
  </div>

  <div class="card">
    <h2>3) File Test (/check/file)</h2>
    <div class="hint small">
      Upload TXT/PDF/DOCX or ZIP/RAR containing those files.<br/>
      For archives, include a TXT with “telegram” or “usdt” to trigger fraud.
    </div>

    <label for="anyFile">Choose file</label>
    <input id="anyFile" type="file" />

    <div class="row" style="margin-top:10px;">
      <button id="btnFile">Check File</button>
    </div>

    <div style="margin-top:12px;">
      <div id="fileStatus" class="small"></div>
      <pre id="fileOut">{}</pre>
    </div>
  </div>

  <script>
    const API_BASE = "http://localhost:5001";

    function setStatus(el, msg, ok) {
      el.innerHTML = ok ? `<span class="ok">${msg}</span>` : `<span class="bad">${msg}</span>`;
    }

    async function safeJson(res) {
      const text = await res.text();
      try { return { json: JSON.parse(text), raw: text }; }
      catch { return { json: null, raw: text }; }
    }

    // -------- TEXT --------
    const textMessage = document.getElementById("textMessage");
    const textOut = document.getElementById("textOut");
    const textStatus = document.getElementById("textStatus");

    document.getElementById("btnTextSafe").onclick = () => {
      textMessage.value = "Hello, how are you today?";
    };
    document.getElementById("btnTextTelegram").onclick = () => {
      textMessage.value = "Contact me on telegram @john_doe";
    };
    document.getElementById("btnTextCrypto").onclick = () => {
      textMessage.value = "Send 50 USDT to my wallet";
    };

    document.getElementById("btnText").onclick = async () => {
      textOut.textContent = "{}";
      setStatus(textStatus, "Sending request...", true);

      try {
        const res = await fetch(`${API_BASE}/check/text`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: textMessage.value })
        });

        const { json, raw } = await safeJson(res);
        if (!res.ok) {
          setStatus(textStatus, `HTTP ${res.status}`, false);
          textOut.textContent = raw;
          return;
        }

        setStatus(textStatus, json?.fraud ? "BLOCK (fraud=true)" : "ALLOW (fraud=false)", !json?.fraud);
        textOut.textContent = JSON.stringify(json ?? raw, null, 2);
      } catch (e) {
        setStatus(textStatus, "Request failed. Is the API running on localhost:5001?", false);
        textOut.textContent = String(e);
      }
    };

    // -------- IMAGE --------
    const imageFile = document.getElementById("imageFile");
    const imageOut = document.getElementById("imageOut");
    const imageStatus = document.getElementById("imageStatus");

    document.getElementById("btnImage").onclick = async () => {
      imageOut.textContent = "{}";

      if (!imageFile.files || imageFile.files.length === 0) {
        setStatus(imageStatus, "Please choose an image first.", false);
        return;
      }

      setStatus(imageStatus, "Uploading image...", true);

      try {
        const fd = new FormData();
        fd.append("image", imageFile.files[0]);

        const res = await fetch(`${API_BASE}/check/image`, {
          method: "POST",
          body: fd
        });

        const { json, raw } = await safeJson(res);
        if (!res.ok) {
          setStatus(imageStatus, `HTTP ${res.status}`, false);
          imageOut.textContent = raw;
          return;
        }

        setStatus(imageStatus, json?.fraud ? "BLOCK (fraud=true)" : "ALLOW (fraud=false)", !json?.fraud);
        imageOut.textContent = JSON.stringify(json ?? raw, null, 2);
      } catch (e) {
        setStatus(imageStatus, "Request failed. Is the API running on localhost:5001?", false);
        imageOut.textContent = String(e);
      }
    };

    // -------- FILE --------
    const anyFile = document.getElementById("anyFile");
    const fileOut = document.getElementById("fileOut");
    const fileStatus = document.getElementById("fileStatus");

    document.getElementById("btnFile").onclick = async () => {
      fileOut.textContent = "{}";

      if (!anyFile.files || anyFile.files.length === 0) {
        setStatus(fileStatus, "Please choose a file first.", false);
        return;
      }

      setStatus(fileStatus, "Uploading file...", true);

      try {
        const fd = new FormData();
        fd.append("file", anyFile.files[0]);

        const res = await fetch(`${API_BASE}/check/file`, {
          method: "POST",
          body: fd
        });

        const { json, raw } = await safeJson(res);
        if (!res.ok) {
          setStatus(fileStatus, `HTTP ${res.status}`, false);
          fileOut.textContent = raw;
          return;
        }

        setStatus(fileStatus, json?.fraud ? "BLOCK (fraud=true)" : "ALLOW (fraud=false)", !json?.fraud);
        fileOut.textContent = JSON.stringify(json ?? raw, null, 2);
      } catch (e) {
        setStatus(fileStatus, "Request failed. Is the API running on localhost:5001?", false);
        fileOut.textContent = String(e);
      }
    };
  </script>
</body>
</html>
